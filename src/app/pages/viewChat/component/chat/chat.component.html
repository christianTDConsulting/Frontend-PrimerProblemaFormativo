<p-toast key="chat" position="bottom-left"></p-toast>
<!-- app-chat.component.html -->
<div class="chat-container">

  <!-- Indicador de carga de respuesta -->
  <div *ngIf="cargandoRespuesta; else noCargando" class="text-center mt-2">

    <span style="color: green;">Gepeto est치 escribiendo...</span>
  </div>

  <!-- Indicador cuando no hay carga de respuesta -->
  <ng-template #noCargando>
    <div class="text-center mt-2">
      <span style="color: green;">Gepeto est치 online</span>
    </div>
  </ng-template>

  <!-- Panel de desplazamiento para mensajes -->
  <div class="chat-messages" #scrollMe  id = "messageContainer">
    <!-- Iterar sobre los mensajes -->
    <p *ngFor="let mensaje of mensajes;"  [ngClass]="{'mensaje-usuario': mensaje.autor !== 'Gepeto', 'mensaje-asistente': mensaje.autor === 'Gepeto'}">
      
      <!-- Contenedor para mensajes de Gepeto -->
      <ng-container *ngIf="mensaje.autor === 'Gepeto'" id="gepeto">
        <div class="grid">
          <div >
            <img class="gepeto" src="assets/images/gepeto/normal.webp" alt="Gepeto">
          </div>

         
          <div class="inline ml-2" >
            <p>
              <span class="bold">{{ mensaje.autor }}</span> - {{ mensaje.timestamp }}
            </p>
          </div>
          <div class="col-12">
            <p [innerHTML]="formatMessage(mensaje.texto)"></p>
            
              <!-- Muestra las imagenes  -->
              <ng-template [ngIf]="hasMultipleImages(mensaje.texto)">
                <p-button 
                [text]="true" 
                [raised]="true" 
                icon="pi pi-image"  
                label="Ver im치genes" 
                (click)="actualizarGaleria(mensaje.texto)">
              </p-button>

                <p-galleria
                [value]="images"
                [(visible)]="displayBasic"
                [responsiveOptions]="responsiveOptions"
                [containerStyle]="{ 'max-width': '850px' }"
                [numVisible]="7"
                [circular]="true"
                [fullScreen]="true"
                [showItemNavigators]="true"
                [showThumbnails]="false"
            >
                <ng-template pTemplate="item" let-item>
                    <img [src]="item.itemImageSrc" style="width: 100%; display: block;" />
                </ng-template>
              </p-galleria>
            </ng-template>
            

           
          </div>
        </div>
      </ng-container>

      <!-- Contenedor para mensajes del usuario -->
      <ng-container *ngIf="mensaje.autor !== 'Gepeto'" id="user">
        <div class="grid" >
          
          <div>
            <p-avatar icon="pi pi-user" styleClass="mr-2" size="xlarge"></p-avatar>
          </div>

          <div class="inline ml-2" >
            <p>
              <span class="bold">{{ mensaje.autor }}</span> - {{ mensaje.timestamp }}
            </p>
          </div>
          
          <div class="col-12 " >
            <p [innerHTML]="formatMessage(mensaje.texto)"></p>
          </div>
        </div>
       
      </ng-container>

      
   
    <p-divider ></p-divider> 
 
    </p>
  
  </div>



  <!-- Entrada de texto para nuevos mensajes -->
  <div class="chat-input">

      <p-progressSpinner *ngIf="cargandoRespuesta" [style]="{width: '50px', height: '50px'}"></p-progressSpinner>

      <app-emoji-picker (emojiSelected)="handleEmojiSelected($event)"></app-emoji-picker>
 
      <input 
        type="text"
        pInputText 
        [(ngModel)]="nuevoMensaje" 
        pAutoFocus [autofocus]="true" 
        (keyup.enter)="cargandoRespuesta ?  showCargandoInfo(): enviarMensaje()" 
        placeholder="Pregunta sobre el cat치logo..." 
        id="messageInput" 
        #messageInput>
      
      <p-button label="Enviar" (click)="enviarMensaje()" [disabled]="cargandoRespuesta"></p-button>

  </div>

